<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <?!= include('styles'); ?>
  </head>
  <body>
    <header class="topbar">
      <div class="topbar-left">
        <div class="avatar">J</div>
        <div class="title-wrap">
          <div class="app-title" id="appTitle">Training Planner</div>
          <div class="app-sub" id="subTitle">Loading‚Ä¶</div>
        </div>
      </div>

      <div class="topbar-right" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end;">
        <div id="stravaStatusBadge" class="strava-status hidden"></div>
        <button class="btn ghost" id="resumeBackfillBtn" style="min-width:auto; padding:8px 10px;" title="Resume historical sync">Resume Backfill</button>
        <button class="btn ghost" id="restartBackfillBtn" style="min-width:auto; padding:8px 10px;" title="Restart historical sync cursor">Restart Backfill</button>
        <button class="btn ghost" id="connectStravaBtn" style="min-width:auto; padding:8px 10px;">Connect Strava</button>
        <button class="icon-btn" id="refreshBtn" aria-label="Refresh">‚ü≥</button>
      </div>
    </header>

    <main class="container">
      <!-- TODAY -->
      <section id="view-today" class="view"></section>

      <!-- PLAN -->
      <section id="view-plan" class="view hidden"></section>

      <!-- ACTIVITIES -->
      <section id="view-activities" class="view hidden"></section>

      <!-- STATS -->
      <section id="view-stats" class="view hidden"></section>
    </main>

    <!-- Bottom Nav -->
    <nav class="bottom-nav" role="navigation" aria-label="Bottom navigation">
      <button class="nav-item active" data-view="today">
        <div class="nav-ico">‚òÄ</div>
         <div class="nav-txt">Week</div>
      </button>
      <button class="nav-item" data-view="plan">
        <div class="nav-ico">üìÖ</div>
        <div class="nav-txt">Plan</div>
      </button>
      <button class="nav-item" data-view="activities">
        <div class="nav-ico">üìà</div>
        <div class="nav-txt">Activities</div>
      </button>
      <button class="nav-item" data-view="stats">
        <div class="nav-ico">üèÖ</div>
        <div class="nav-txt">Stats</div>
      </button>
    </nav>

    <!-- Modal -->
    <div id="modalOverlay" class="modal-overlay hidden" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-header">
          <div>
            <div id="modalTitle" class="modal-title">Edit session</div>
            <div id="modalMeta" class="modal-meta"></div>
          </div>
          <button class="icon-btn" id="modalCloseBtn" aria-label="Close">‚úï</button>
        </div>

        <div class="modal-body">
          <label class="field">
            <span>Status</span>
            <select id="editStatus">
              <option value="DONE">Done</option>
              <option value="PARTIAL">Partial</option>
              <option value="SKIPPED">Skipped</option>
            </select>
          </label>

          <div class="row">
            <label class="field">
              <span>Actual km</span>
              <input id="editKm" type="number" inputmode="decimal" step="0.1" />
            </label>

            <label class="field">
              <span>Actual min</span>
              <input id="editMin" type="number" inputmode="numeric" step="1" />
            </label>
          </div>

          <label class="field">
            <span>Notes</span>
            <textarea id="editNotes" rows="3" placeholder="Optional‚Ä¶"></textarea>
          </label>
        </div>

        <div class="modal-footer">
          <button class="btn ghost" id="modalCancelBtn">Cancel</button>
          <button class="btn primary" id="modalSaveBtn">Save</button>
        </div>
      </div>
    </div>


    <!-- Auth Overlay -->
    <div id="authOverlay" class="modal-overlay hidden" aria-hidden="true">
      <div class="modal" style="max-width:420px;">
        <div class="modal-header">
          <div>
            <div id="authTitle" class="modal-title">Login</div>
            <div id="authMeta" class="modal-meta">Sign in to continue</div>
          </div>
        </div>
        <div class="modal-body">
          <label class="field"><span>Email</span><input id="authEmail" type="email" autocomplete="email" /></label>
          <label class="field"><span id="authNameLabel" class="hidden">Display name</span><input id="authDisplayName" class="hidden" type="text" /></label>
          <label class="field"><span>Password</span><input id="authPassword" type="password" autocomplete="current-password" /></label>
          <button class="btn primary" id="authSubmitBtn" style="width:100%;">Login</button>
        </div>
      </div>
    </div>


    <!-- Plan Import Modal -->
    <div id="planImportOverlay" class="modal-overlay hidden" aria-hidden="true">
      <div class="modal" style="max-width:900px;">
        <div class="modal-header">
          <div>
            <div class="modal-title">Add Plan (Import CSV)</div>
            <div class="modal-meta">Upload CSV, preview mapping and issues, then import.</div>
          </div>
          <button class="icon-btn" id="planImportCloseBtn" aria-label="Close">‚úï</button>
        </div>
        <div class="modal-body">
          <label class="field"><span>CSV File</span><input id="planImportFile" type="file" accept=".csv,text/csv" /></label>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px;">
            <button class="btn ghost" id="planImportPreviewBtn">Preview</button>
            <button class="btn primary" id="planImportCommitBtn" disabled>Import</button>
          </div>
          <div id="planImportSummary" class="hero-sub">No file loaded.</div>
          <div id="planImportPreviewWrap" style="margin-top:10px; overflow:auto; max-height:300px;"></div>
        </div>
      </div>
    </div>

    <!-- Plan Generator Modal -->
    <div id="planGenerateOverlay" class="modal-overlay hidden" aria-hidden="true">
      <div class="modal" style="max-width:760px;">
        <div class="modal-header">
          <div>
            <div class="modal-title">Create Plan (Generator)</div>
            <div class="modal-meta">Generate a deterministic running plan and write to Plan sheet.</div>
          </div>
          <button class="icon-btn" id="planGenerateCloseBtn" aria-label="Close">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="row">
            <label class="field"><span>Plan Name</span><input id="genPlanName" type="text" placeholder="Spring 10k" /></label>
            <label class="field"><span>Target Distance (km)</span><input id="genTargetKm" type="number" step="0.1" value="10" /></label>
          </div>
          <div class="row">
            <label class="field"><span>Plan Length (weeks)</span><input id="genLengthWeeks" type="number" step="1" value="12" /></label>
            <label class="field"><span>Training Days / Week</span><input id="genDaysPerWeek" type="number" step="1" min="2" max="7" value="4" /></label>
          </div>
          <div class="row">
            <label class="field"><span>Long Run Day</span>
              <select id="genLongRunDay">
                <option>MON</option><option>TUE</option><option>WED</option><option>THU</option><option>FRI</option><option>SAT</option><option selected>SUN</option>
              </select>
            </label>
            <label class="field"><span>Start Date (optional)</span><input id="genStartDate" type="date" /></label>
          </div>
          <div class="row">
            <label class="field"><span><input id="genIncludeIntervals" type="checkbox" checked /> Include intervals</span></label>
            <label class="field"><span><input id="genIncludeTempo" type="checkbox" checked /> Include tempo</span></label>
          </div>
          <div style="display:flex; justify-content:flex-end; margin-top:8px;"><button class="btn primary" id="planGenerateCommitBtn">Generate & Save</button></div>
          <div id="planGenerateSummary" class="hero-sub" style="margin-top:8px;"></div>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>

    <?!= include('app'); ?>
  </body>
</html>
